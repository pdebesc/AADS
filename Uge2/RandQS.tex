\section*{RandQS}
\subsubsection*{For any given key $x$ in $S$, bound the expected depth of $x$ in the search tree generated by RandQS}

Let the key $x$ in $S$ have rank $i$ and denote it with $s_{(i)}$. Let $s_{(j)}$ be another key in $S$ with rank $j$ where $j>i$. 
Then $s_{(j)}$ is only an ancestor to $s_{(i)}$ if $s_{(j)}$ is chosen as the pivot element before any of the elements in $S_{(ij)} = \{s_{(i)},\ldots,s_{(j)}\}$. For $j<i$ the $s_{(j)}$ element is an ancestor if it is the first element chosen in $S_{(ji)}$.

Define the random variable 
$$
X_{ij}=
\begin{cases}
1, & s_{(j)} \text{ is ancestor to } s_{(i)}\\
0, &\text{else}
\end{cases}.
$$

For $j>i$ 
\\
The probability that $P(X_{ij}) = 1/(j-i+1)$.
\\
For $j=i$ 
\\
The probability that $P(X_{ij}) = 0$.
\\
For $j<i$ 
\\
The probability that $P(X_{ij}) = 1/(i-j+1)$.

The sum $\sum_{j=1}^n X_{ij}$ will count the number of ancestors of $s_{(i)}$, and the number of ancestors tells us at which depth the $s_{(i)}$ are in the BST.

So the expected depth $s_{(i)}$ is
\begin{align*}
E \sum_{j=1}^n X_{ij} &=  \sum_{j=1}^n EX_{ij} \\
                      &= \sum_{j<i} EX_{ij} + \sum_{j>i} EX_{ij} \\
											&= \sum_{j<i} P(X_{ij}) + \sum_{j>i} P(X_{ij})\\
											&= \sum_{j<i} \frac{1}{i-j+1} + \sum_{j>i} \frac{1}{j-i+1}\\
											&= \sum_{k=2}^i \frac{1}{k} + \sum_{k=2}^{n-i+1} \frac{1}{k}\\
											&\leq \sum_{k=1}^n \frac{1}{k} + \sum_{k=1}^{n} \frac{1}{k}\\
											&= 2\sum_{k=1}^n \frac{1}{k} = 2H_n = O(\ln(n))
\end{align*}
Where $H_n$ is defined as in the notes.

Hence the expected depth of any key $x$ in $S$ is bounded by $O(\ln(n))$